<html>
    <head>
        <script src="./static/socket.io.js"></script>
        <script>WEB_SOCKET_SWF_LOCATION="./static/WebSocketMain.swf"</script>
        <script language="javascript" type="text/javascript" src="./static/jquery.js"></script>
    </head> 
    <body>    
        <script type="text/javascript">
        var username = "{{username}}"
        var socketio_sever;
        socketio_sever = new io.Socket(window.location.hostname,
                                        {port: 8001, rememberTransport: false});
        socketio_sever.connect();
        socketio_sever.send({"new_user": username});

        function on_write(e) {
            content = document.getElementById("input").value;
            message = {"new_message": {"username": username, "content": content}};
            console.log(message)
            socketio_sever.send(message);   
        }

        socketio_sever.addEvent('message', function(message) {
            console.log(message);
            
            if (message.new_client != null) {
                element = "<textarea id='" + message.new_client + "' rows='10' cols='30' readonly='readonly'></textarea>";
                $(".container").append(element);
            }
            else if (message.new_message != null) {
                sender= message.new_message.username;
                content = message.new_message.content;
                document.getElementById(sender).value = content;
            }
            else if (message.remove_client != null) {
                $("#" + message.remove_client).remove();
            }
            
        });
        </script>
        
        <div class="container">
            <textarea id="input" rows="10" cols="30" onkeyup="on_write(event)"></textarea>
        </div>

    </body>
</html>