<html>
    <head>
        <script src="./static/socket.io.js"></script>
        <script>WEB_SOCKET_SWF_LOCATION="./static/WebSocketMain.swf"</script>
        <script language="javascript" type="text/javascript" src="./static/jquery.js"></script>
        <script>USER_ID={{user_id}}</script>
    </head> 
    <body>    
        <script type="text/javascript">

        var socketio_sever;
        socketio_sever = new io.Socket(window.location.hostname,
                                        {port: 8001, rememberTransport: false});
        socketio_sever.connect();

        for (var i=0; i<=USER_ID ;i++)
        {
            console.log(i);
            $(".container").append("<textarea id='" + i + "' rows='10' cols='30'></textarea>");
        }

        function on_write(e) {
            update();     
        }

        function update(){
            content = document.getElementById("input").value;
            message = USER_ID + " " + content;
            //console.log(message);
            socketio_sever.send(message);
        }

        socketio_sever.addEvent('message', function(new_message) {
            console.log(new_message);
            new_message = JSON.parse(new_message);
            console.log(new_message);
            if (new_message[0] == "new_client")
                $(".container").append("<textarea id='" + new_message[1] + "' rows='10' cols='30'></textarea>");
            else
                document.getElementById(new_message[0]).value = new_message[1];
    
        });
        </script>
        
        <div class="container">
            <textarea id="input" rows="10" cols="30" onkeyup="on_write(event)"></textarea>
        </div>

    </body>
</html>